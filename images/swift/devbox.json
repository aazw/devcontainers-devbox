{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.16.0/.schema/devbox.schema.json",
  "packages": [
    // ============================================================================
    // システムライブラリ
    // ============================================================================

    // GNU C ライブラリ (glibc)
    // Linux システムの基本的な C ライブラリ
    // Swift コンパイラが生成するバイナリの実行に必要
    // https://www.gnu.org/software/libc/
    // https://search.nixos.org/packages?show=glibc&query=glibc
    "glibc@2.40-66",

    // ============================================================================
    // Swift コンパイラ
    // ============================================================================
    //
    // 【課題】
    // Swift パッケージは Nixpkgs の最新リビジョンで aarch64-linux 向けビルドが
    // 失敗している（2025年11月以降）。
    // 原因: libdispatch のコードが clang 21.x の厳格な警告設定（-Werror -Wsign-conversion）
    //       でコンパイルエラーになる。
    //
    // Hydra（NixOS公式CI）でのビルド状況:
    //   https://hydra.nixos.org/job/nixpkgs/trunk/swift.aarch64-linux
    //   - 2025-11-24: Dependency failed (swift-wrapper-5.10.1)
    //   - 2025-11-14: Dependency failed (swift-wrapper-5.10.1)
    //   - 2025-10-22: Succeeded (swift-wrapper-5.10.1) ← このリビジョンを使用
    //   - 2025-10-12: Succeeded (swift-wrapper-5.10.1)
    //
    // 【対応】
    // Hydra でビルド成功している nixpkgs リビジョン（2025-10-22）を明示的に指定。
    // これにより cache.nixos.org からビルド済みバイナリを取得可能。
    //
    // 注意: "swift@5.10.1" + "nixpkgs.commit" の組み合わせは動作しない。
    //       Devbox のバージョン解決は nixhub.io のレジストリを参照するため、
    //       nixpkgs.commit の設定は無視される。
    //       そのため、flake 参照形式で直接リビジョンを指定する必要がある。
    //
    // 【今後】
    // Nixpkgs の upstream で修正されたら、通常の "swift@バージョン" 形式に戻すこと。
    //
    // 【既知の警告】
    // "glibc not found for 'aarch64-unknown-linux-gnu'; C stdlib may be unavailable"
    // という警告が表示されるが、コンパイル・実行には影響しない。
    // これは Nixpkgs の Swift パッケージの既知の問題。
    // 参考: https://github.com/NixOS/nixpkgs/issues/311565
    //
    // ============================================================================

    // Swift コンパイラ (5.10.1)
    // Appleが開発した汎用プログラミング言語
    // https://github.com/apple/swift
    // https://search.nixos.org/packages?show=swift&query=swift
    // https://www.nixhub.io/packages/swift
    // https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/compilers/swift/default.nix
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swift",

    // Swift Package Manager (5.10.1)
    // Swift のパッケージマネージャ（swift-build, swift-package, swift-run, swift-test）
    // https://github.com/apple/swift-package-manager
    // https://search.nixos.org/packages?show=swiftpm&query=swiftpm
    // https://www.nixhub.io/packages/swiftpm
    // https://github.com/NixOS/nixpkgs/blob/master/pkgs/development/compilers/swift/swiftpm/default.nix
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swiftpm",

    // ============================================================================
    // Swift コンパイラ内部コンポーネント
    // ============================================================================
    //
    // 通常は swift パッケージに含まれるが、特殊なビルド構成や
    // デバッグ目的で個別に必要になる場合がある。
    //
    // ============================================================================

    // Swift Driver
    // コンパイラのフロントエンド。ソースファイルの解析とコンパイルジョブの管理を行う
    // swift/swiftc コマンドの実体
    // https://github.com/apple/swift-driver
    // https://search.nixos.org/packages?show=swiftPackages.swift-driver
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swiftPackages.swift-driver",

    // Swift Compiler (unwrapped)
    // Nix ラッパースクリプトを含まない素のSwiftコンパイラ
    // 低レベルのデバッグやカスタムビルド構成で使用
    // https://search.nixos.org/packages?show=swiftPackages.swift-unwrapped
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swiftPackages.swift-unwrapped",

    // Swift Compiler (without swift-driver)
    // 新しい swift-driver を使用しない従来のコンパイラ構成
    // 互換性テストや特定の環境で必要になる場合がある
    // https://search.nixos.org/packages?show=swiftPackages.swiftNoSwiftDriver
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swiftPackages.swiftNoSwiftDriver",

    // ============================================================================
    // Swift ランタイムライブラリ
    // ============================================================================

    // Swift Dispatch ライブラリ (libdispatch)
    // 非同期処理のためのランタイムライブラリ
    // コンパイルしたバイナリの実行時に libdispatch.so が必要
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swift-corelibs-libdispatch",

    // Swift Foundation ライブラリ
    // 基本的なデータ型（String, Date, Data, URL など）とユーティリティを提供
    // macOS の Foundation.framework の Linux/クロスプラットフォーム実装
    // https://github.com/apple/swift-corelibs-foundation
    // https://search.nixos.org/packages?show=swiftPackages.Foundation
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swiftPackages.Foundation",

    // ============================================================================
    // Swift 開発ツール
    // ============================================================================

    // Swift Format
    // Swift コードの自動フォーマッター・リンター
    // swift-format format / swift-format lint コマンドを提供
    // https://github.com/apple/swift-format
    // https://search.nixos.org/packages?show=swift-format
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swift-format",

    // XCTest フレームワーク
    // Swift/Objective-C 向けの単体テストフレームワーク
    // swift test コマンドで使用される
    // https://github.com/apple/swift-corelibs-xctest
    // https://search.nixos.org/packages?show=swiftPackages.XCTest
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swiftPackages.XCTest",

    // Swift-DocC
    // Swift コードからドキュメントを生成するツール
    // DocC 形式のドキュメンテーションコメントを解析し、静的サイトを生成
    // https://github.com/apple/swift-docc
    // https://search.nixos.org/packages?show=swiftPackages.swift-docc
    "github:NixOS/nixpkgs/01b6809f7f9d1183a2b3e081f0a1e6f8f415cb09#swiftPackages.swift-docc"
  ]
}
